<ion-header [translucent]="true">
	<ion-toolbar>
		<ion-title> INIMATIC </ion-title>
	</ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
	<!-- <ion-header collapse="condense">
		<ion-toolbar>
			<ion-title size="large">Blank</ion-title>
		</ion-toolbar>
	</ion-header> -->

	<div id="container">
		<div *ngIf="isInitiator">
			<strong>1. Open Inimatic application on your phone</strong>
			<p>and point it to the screen</p>
		</div>
		<div *ngIf="! isInitiator">
			<strong>Is not Initiator</strong>
		</div>
		<p>{{sessionID}}</p>
		<qrcode
			[qrdata]="sessionID"
			[width]="256"
			[errorCorrectionLevel]="'M'"
		></qrcode>
		<div>
			<label for="outgoing">Outgoing Signal Data:</label>
			<textarea
				id="outgoing"
				[(ngModel)]="outgoingSignal"
				readonly
			></textarea>
			<button (click)="copyToClipboard(outgoingSignal)">
				Copy Signal Data
			</button>
		</div>
		<div>
			<label for="incoming">Incoming Signal Data:</label>
			<textarea id="incoming" [(ngModel)]="incomingSignal"></textarea>
		</div>
		<button (click)="connect()" style="display: block">
			Connect Using Incoming Data
		</button>
		<button (click)="send()" style="display: block">Send Message</button>
	</div>
	<!-- Fallback for iOS PWA -->
	<input
		#fileinput
		type="file"
		accept="image/*;capture=camera"
		hidden
		(change)="handleFile($event)"
	/>
	<div  *ngIf="!isInitiator">
		<!-- Trigger the file input -->
		<ion-button expand="full" (click)="captureImage()">
			<ion-icon slot="start" name="camera"></ion-icon>
			Capture Image
		</ion-button>

		<ion-button expand="full" (click)="startScan()">
			<ion-icon slot="start" name="qr-scanner"></ion-icon>
			Start scan
		</ion-button>

		<ion-button
			expand="full"
			(click)="reset()"
			color="warning"
			*ngIf="scanResult"
		>
			<ion-icon slot="start" name="refresh"></ion-icon>
			Reset
		</ion-button>

		<!-- Shows our camera stream -->
		<video #video width="30%"></video>

		<!-- Used to render the camera stream images -->
		<canvas #canvas></canvas>

		<!-- Stop our scanner preview if active -->
		<ion-button expand="full" (click)="stopScan()" color="danger">
			<ion-icon slot="start" name="close"></ion-icon>
			Stop scan
		</ion-button>
	</div>

	<ion-card *ngIf="scanResult">
		<ion-card-header>
			<ion-card-title>QR Code</ion-card-title>
		</ion-card-header>
		<ion-card-content> {{ scanResult }} </ion-card-content>
	</ion-card>
</ion-content>
